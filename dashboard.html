<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade Journal - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Your existing styles remain the same */
        :root {
            --profit: #10b981;
            --loss: #ef4444;
            --primary: #3b82f6;
            --bg: #f8fafc;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: #1f2937;
            line-height: 1.5;
        }
        
        .card {
            background: white;
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 16px;
            border: 1px solid #e5e7eb;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .btn {
            background: var(--primary);
            color: white;
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            margin-top: 8px;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .btn-sm {
            padding: 8px 12px;
            font-size: 14px;
            width: auto;
            margin: 2px;
        }
        
        .profit { color: var(--profit); }
        .loss { color: var(--loss); }
        
        .trade-item {
            border-left: 4px solid var(--primary);
            padding: 12px;
            margin: 8px 0;
            background: #f9fafb;
            border-radius: 0 8px 8px 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 16px;
        }
        
        @media (min-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 12px;
            }
        }
        
        .stat-card {
            background: white;
            padding: 12px;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            margin: 4px 0;
        }
        
        .risk-calculator {
            background: #f0f9ff;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            margin: 8px 0;
            font-size: 13px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        @media (min-width: 480px) {
            .form-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .pip-display {
            font-size: 0.8em;
            color: #6b7280;
            margin-top: 2px;
        }
        
        .market-type-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.65em;
            font-weight: bold;
            margin-left: 6px;
        }
        
        .forex-badge { background: #dbeafe; color: #1e40af; }
        .indices-badge { background: #fce7f3; color: #be185d; }
        
        .section-title {
            font-size: 1.2em;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        /* Mobile optimizations */
        .mobile-scroll {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .trade-actions {
            display: flex;
            gap: 4px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        
        @media (min-width: 768px) {
            .trade-actions {
                margin-top: 0;
                justify-content: flex-end;
            }
        }
        
        .screenshot-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .screenshot-modal img {
            max-width: 90%;
            max-height: 80%;
            border-radius: 8px;
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
        }
        
        /* Compact mobile forms */
        .compact-form .form-group {
            margin-bottom: 8px;
        }
        
        .compact-form input, 
        .compact-form select, 
        .compact-form textarea {
            padding: 10px;
            font-size: 14px;
        }

        /* Loading states */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Metric cards */
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 8px;
        }
        
        .metric-card {
            background: #f8fafc;
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid #3b82f6;
        }
        
        .metric-value {
            font-weight: bold;
            font-size: 1.1em;
            margin: 2px 0;
        }
        
        .metric-label {
            font-size: 0.75em;
            color: #6b7280;
            text-transform: uppercase;
        }

        /* Psychological metrics */
        .psych-metric {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin: 4px 0;
        }

        .psych-value {
            font-size: 1.3em;
            font-weight: bold;
            text-align: center;
        }

        .psych-label {
            font-size: 0.8em;
            text-align: center;
            opacity: 0.9;
        }

        /* Tab Styles */
        .tab-button {
            transition: all 0.3s ease;
            cursor: pointer;
            background: none;
            border: none;
            outline: none;
            padding: 12px 24px;
            font-weight: 600;
            border-bottom: 3px solid transparent;
        }

        .tab-button.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .tab-button:not(.active) {
            color: #6b7280;
        }

        .tab-button:not(.active):hover {
            color: #374151;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Mobile Menu Styles */
        #mobileMenu {
            transition: all 0.3s ease;
        }

        #mobileMenu.hidden {
            display: none;
        }

        #mobileMenu:not(.hidden) {
            display: block;
        }

        /* Ensure proper z-index for mobile menu */
        nav {
            position: relative;
            z-index: 40;
        }

        #mobileMenu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 50;
        }

        /* Pagination Styles */
        #pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            padding: 16px 0;
        }

        .pagination-btn {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            background: white;
            color: #374151;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .pagination-btn:hover:not(.pagination-disabled) {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .pagination-btn:active:not(.pagination-disabled) {
            transform: scale(0.95);
        }

        .pagination-disabled {
            background: #f3f4f6;
            color: #9ca3af;
            border-color: #e5e7eb;
            cursor: not-allowed;
        }

        .pagination-current {
            padding: 8px 16px;
            background: #3b82f6;
            color: white;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
        }

        .pagination-ellipsis {
            padding: 8px 4px;
            color: #6b7280;
            font-size: 14px;
        }

        @media (max-width: 640px) {
            .pagination-btn, .pagination-current {
                padding: 6px 12px;
                font-size: 12px;
            }
            
            #pagination {
                gap: 4px;
            }
        }

        /* NEW CALENDAR STYLES */
        .calendar-day {
            transition: all 0.2s ease;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 8px;
            min-height: 100px;
            cursor: pointer;
            position: relative;
        }
        
        .calendar-day:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .calendar-day.has-trades {
            background-color: #dbeafe;
            border-color: #3b82f6;
        }
        
        .calendar-day.profit-day {
            background-color: #dcfce7;
            border-color: #10b981;
        }
        
        .calendar-day.loss-day {
            background-color: #fee2e2;
            border-color: #ef4444;
        }
        
        .calendar-day.active {
            background-color: #3b82f6;
            color: white;
        }
        
        .calendar-day.today {
            border: 2px solid #f59e0b;
        }
        
        .calendar-nav-btn {
            transition: all 0.2s ease;
            padding: 8px 12px;
            border-radius: 6px;
            background: #f3f4f6;
            border: none;
            cursor: pointer;
        }
        
        .calendar-nav-btn:hover {
            background-color: #e5e7eb;
        }
        
        .calendar-filter-btn.active {
            background-color: #3b82f6;
            color: white;
        }
        
        .trade-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: inline-block;
            margin: 0 1px;
        }
        
        .trade-profit {
            background-color: #10b981;
        }
        
        .trade-loss {
            background-color: #ef4444;
        }
        
        .trade-breakeven {
            background-color: #6b7280;
        }
        
        .calendar-view {
            transition: all 0.3s ease;
        }
        
        .calendar-day-header {
            font-weight: 600;
            color: #374151;
            text-align: center;
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .calendar-empty-day {
            background-color: #f9fafb;
            border: 1px dashed #d1d5db;
            border-radius: 8px;
            min-height: 100px;
        }
        
        .calendar-day-number {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 4px;
        }
        
        .calendar-day-trades {
            font-size: 0.75em;
            color: #6b7280;
            margin-top: 4px;
        }
        
        .calendar-day-pnl {
            font-size: 0.8em;
            font-weight: 600;
            margin-top: 2px;
        }
        
        .week-time-slot {
            border-bottom: 1px solid #e5e7eb;
            padding: 4px 0;
            font-size: 0.8em;
            color: #6b7280;
        }
        
        .week-trade-item {
            font-size: 0.7em;
            padding: 2px 4px;
            border-radius: 4px;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .week-trade-profit {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .week-trade-loss {
            background-color: #fee2e2;
            color: #991b1b;
        }
    </style>
</head>
<body class="bg-gray-900 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-gray-800 border-b border-gray-700">
        <div class="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-lg sm:text-xl font-bold text-white">üí± Trading Journal</h1>
                </div>
                
                <!-- Desktop Menu -->
                <div class="hidden sm:flex items-center space-x-4">
                    <!-- Accounts Dropdown -->
                    <div class="relative" id="accountsDropdown">
                        <button id="accountsToggle" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm flex items-center">
                            <span id="currentAccountName">Main Account</span>
                            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div id="accountsMenu" class="hidden absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-xl z-50 border border-gray-200">
                            <div class="p-3 border-b border-gray-200">
                                <h3 class="font-semibold text-gray-800">Trading Accounts</h3>
                            </div>
                            <div id="accountsList" class="max-h-60 overflow-y-auto">
                                <!-- Accounts will be loaded here -->
                            </div>
                            <div class="p-3 border-t border-gray-200">
                                <button onclick="showAddAccountModal()" class="w-full bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded text-sm flex items-center justify-center">
                                    <span class="mr-2">+</span> Add New Account
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <span id="user-email" class="text-gray-300 text-sm">Loading...</span>
                    <button onclick="exportTrades()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-sm">
                        Export
                    </button>
                    <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg text-sm">
                        Logout
                    </button>
                </div>

                <!-- Mobile Menu -->
                <div class="sm:hidden flex items-center">
                    <button id="mobileMenuButton" class="text-gray-300 hover:text-white p-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile Dropdown Menu -->
            <div id="mobileMenu" class="sm:hidden hidden bg-gray-700 border-t border-gray-600">
                <div class="px-2 pt-2 pb-3 space-y-1">
                    <!-- Mobile Accounts Section -->
                    <div class="px-3 py-2">
                        <h4 class="text-gray-300 text-sm font-semibold mb-2">Trading Accounts</h4>
                        <div id="mobileAccountsList" class="space-y-1">
                            <!-- Mobile accounts will be loaded here -->
                        </div>
                        <button onclick="showAddAccountModal()" class="w-full bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded text-sm mt-2 flex items-center justify-center">
                            <span class="mr-2">+</span> Add New Account
                        </button>
                    </div>
                    
                    <div class="text-gray-300 px-3 py-2 text-sm" id="mobile-user-email">Loading...</div>
                    <button onclick="exportTrades()" class="block w-full text-left bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded text-sm mb-1">
                        Export Trades
                    </button>
                    <button onclick="logout()" class="block w-full text-left bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded text-sm">
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Screenshot Modal -->
    <div id="screenshotModal" class="screenshot-modal">
        <button class="close-modal" onclick="closeScreenshotModal()">√ó</button>
        <img id="screenshotImage" src="" alt="Trade Screenshot">
    </div>

    <!-- Affirmation Modals (your existing modals) -->
    <div id="affirmationModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden backdrop-blur-sm">
        <!-- Your existing affirmation modal content -->
    </div>

    <!-- Random Affirmation Modal -->
    <div id="randomAffirmationModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden backdrop-blur-sm">
        <!-- Your existing random affirmation modal content -->
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto py-4 sm:py-6 px-3 sm:px-6 lg:px-8">
        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg shadow-xl text-center">
                <div class="loading-spinner"></div>
                <p class="mt-2">Loading your trades...</p>
            </div>
        </div>

        <!-- Tab Navigation - ADDED CALENDAR TAB -->
        <div class="flex border-b border-gray-300 mb-6 bg-white rounded-t-lg">
            <button id="dashboardTab" class="tab-button active">
                üìä Dashboard
            </button>
            <button id="tradesTab" class="tab-button">
                üìã Trade History
            </button>
            <!-- NEW CALENDAR TAB -->
            <button id="calendarTab" class="tab-button">
                üìÖ Calendar
            </button>
            <button id="affirmationsTab" class="tab-button">
                üåü Affirmations
            </button>
        </div>

        <!-- Dashboard Tab Content (your existing content) -->
        <div id="dashboardContent" class="tab-content active">
            <!-- Your existing dashboard content -->
        </div>

        <!-- Trade History Tab Content (your existing content) -->
        <div id="tradesContent" class="tab-content">
            <!-- Your existing trade history content -->
        </div>

        <!-- NEW CALENDAR TAB CONTENT -->
        <div id="calendarContent" class="tab-content">
            <div class="card">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                    <h3 class="section-title mb-4 md:mb-0">üìÖ Trading Calendar</h3>
                    <div class="flex flex-wrap gap-2">
                        <button id="viewMonth" class="calendar-filter-btn active bg-blue-500 text-white px-4 py-2 rounded-lg text-sm">
                            Month View
                        </button>
                        <button id="viewWeek" class="calendar-filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm">
                            Week View
                        </button>
                        <button id="viewDay" class="calendar-filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm">
                            Day View
                        </button>
                        <button onclick="showDateFilterModal()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg text-sm flex items-center">
                            <span class="mr-2">üîç</span> Filter by Date
                        </button>
                    </div>
                </div>

                <!-- Calendar Navigation -->
                <div class="flex justify-between items-center mb-6">
                    <button id="prevPeriod" class="calendar-nav-btn bg-gray-200 hover:bg-gray-300 text-gray-700 p-2 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    
                    <h2 id="calendarTitle" class="text-xl font-bold text-gray-800">January 2024</h2>
                    
                    <button id="nextPeriod" class="calendar-nav-btn bg-gray-200 hover:bg-gray-300 text-gray-700 p-2 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </button>
                </div>

                <!-- Month View -->
                <div id="monthView" class="calendar-view">
                    <div class="grid grid-cols-7 gap-1 mb-2">
                        <div class="calendar-day-header">Sun</div>
                        <div class="calendar-day-header">Mon</div>
                        <div class="calendar-day-header">Tue</div>
                        <div class="calendar-day-header">Wed</div>
                        <div class="calendar-day-header">Thu</div>
                        <div class="calendar-day-header">Fri</div>
                        <div class="calendar-day-header">Sat</div>
                    </div>
                    <div id="monthGrid" class="grid grid-cols-7 gap-1">
                        <!-- Calendar days will be populated here -->
                    </div>
                </div>

                <!-- Week View -->
                <div id="weekView" class="calendar-view hidden">
                    <div class="grid grid-cols-8 gap-1 mb-2">
                        <div class="calendar-day-header">Time</div>
                        <div class="calendar-day-header">Sun</div>
                        <div class="calendar-day-header">Mon</div>
                        <div class="calendar-day-header">Tue</div>
                        <div class="calendar-day-header">Wed</div>
                        <div class="calendar-day-header">Thu</div>
                        <div class="calendar-day-header">Fri</div>
                        <div class="calendar-day-header">Sat</div>
                    </div>
                    <div id="weekGrid" class="grid grid-cols-8 gap-1">
                        <!-- Week view will be populated here -->
                    </div>
                </div>

                <!-- Day View -->
                <div id="dayView" class="calendar-view hidden">
                    <div id="dayHeader" class="text-center font-bold text-xl mb-4 py-4 bg-blue-50 rounded-lg">
                        Monday, January 1, 2024
                    </div>
                    <div id="dayTrades" class="space-y-4">
                        <!-- Day trades will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Selected Day Trades -->
            <div id="selectedDayTrades" class="card mt-6 hidden">
                <h3 class="section-title" id="selectedDayTitle">Trades for January 1, 2024</h3>
                <div id="selectedDayTradesList" class="space-y-4">
                    <!-- Selected day trades will be populated here -->
                </div>
            </div>
        </div>

        <!-- Affirmations Tab Content (your existing content) -->
        <div id="affirmationsContent" class="tab-content">
            <!-- Your existing affirmations content -->
        </div>
    </div>

    <!-- Your existing modals (Add Account Modal, etc.) -->
    <div id="addAccountModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden backdrop-blur-sm">
        <!-- Your existing add account modal content -->
    </div>

    <!-- NEW DATE FILTER MODAL -->
    <div id="dateFilterModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md mx-4 transform transition-all duration-300 scale-95">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">Filter by Date Range</h3>
                    <button onclick="closeDateFilterModal()" class="text-gray-400 hover:text-gray-600 text-2xl transition-colors duration-200">
                        √ó
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">From Date</label>
                        <input 
                            type="date" 
                            id="filterFromDate" 
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-300"
                        >
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">To Date</label>
                        <input 
                            type="date" 
                            id="filterToDate" 
                            class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-300"
                        >
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button 
                            type="button" 
                            onclick="closeDateFilterModal()" 
                            class="px-6 py-3 text-gray-600 hover:text-gray-800 font-semibold transition-colors duration-200"
                        >
                            Cancel
                        </button>
                        <button 
                            type="button" 
                            onclick="applyDateFilter()" 
                            class="px-8 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl font-semibold hover:from-blue-600 hover:to-purple-700 transition-all duration-300 hover:scale-105 shadow-lg"
                        >
                            Apply Filter
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="./app.js"></script>
    
    <!-- NEW CALENDAR JAVASCRIPT -->
    <script>
        // Calendar state
        let currentView = 'month';
        let currentDate = new Date();
        let dateFilter = null;

        // Initialize calendar when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Your existing initialization code...
            
            // Add calendar initialization
            initializeCalendar();
            setupCalendarEventListeners();
        });

        function initializeCalendar() {
            renderCalendar();
        }

        function setupCalendarEventListeners() {
            // View toggle buttons
            document.getElementById('viewMonth').addEventListener('click', () => switchView('month'));
            document.getElementById('viewWeek').addEventListener('click', () => switchView('week'));
            document.getElementById('viewDay').addEventListener('click', () => switchView('day'));
            
            // Navigation buttons
            document.getElementById('prevPeriod').addEventListener('click', navigatePrevious);
            document.getElementById('nextPeriod').addEventListener('click', navigateNext);
            
            // Add calendar tab to your existing tab switching
            document.getElementById('calendarTab').addEventListener('click', () => switchToTab('calendar'));
        }

        function switchView(view) {
            currentView = view;
            
            // Update active button
            document.getElementById('viewMonth').classList.toggle('active', view === 'month');
            document.getElementById('viewMonth').classList.toggle('bg-blue-500', view === 'month');
            document.getElementById('viewMonth').classList.toggle('text-white', view === 'month');
            document.getElementById('viewMonth').classList.toggle('bg-gray-200', view !== 'month');
            document.getElementById('viewMonth').classList.toggle('text-gray-700', view !== 'month');
            
            document.getElementById('viewWeek').classList.toggle('active', view === 'week');
            document.getElementById('viewWeek').classList.toggle('bg-blue-500', view === 'week');
            document.getElementById('viewWeek').classList.toggle('text-white', view === 'week');
            document.getElementById('viewWeek').classList.toggle('bg-gray-200', view !== 'week');
            document.getElementById('viewWeek').classList.toggle('text-gray-700', view !== 'week');
            
            document.getElementById('viewDay').classList.toggle('active', view === 'day');
            document.getElementById('viewDay').classList.toggle('bg-blue-500', view === 'day');
            document.getElementById('viewDay').classList.toggle('text-white', view === 'day');
            document.getElementById('viewDay').classList.toggle('bg-gray-200', view !== 'day');
            document.getElementById('viewDay').classList.toggle('text-gray-700', view !== 'day');
            
            // Show/hide views
            document.getElementById('monthView').classList.toggle('hidden', view !== 'month');
            document.getElementById('weekView').classList.toggle('hidden', view !== 'week');
            document.getElementById('dayView').classList.toggle('hidden', view !== 'day');
            
            renderCalendar();
        }

        function navigatePrevious() {
            if (currentView === 'month') {
                currentDate.setMonth(currentDate.getMonth() - 1);
            } else if (currentView === 'week') {
                currentDate.setDate(currentDate.getDate() - 7);
            } else if (currentView === 'day') {
                currentDate.setDate(currentDate.getDate() - 1);
            }
            renderCalendar();
        }

        function navigateNext() {
            if (currentView === 'month') {
                currentDate.setMonth(currentDate.getMonth() + 1);
            } else if (currentView === 'week') {
                currentDate.setDate(currentDate.getDate() + 7);
            } else if (currentView === 'day') {
                currentDate.setDate(currentDate.getDate() + 1);
            }
            renderCalendar();
        }

        function renderCalendar() {
            if (currentView === 'month') {
                renderMonthView();
            } else if (currentView === 'week') {
                renderWeekView();
            } else if (currentView === 'day') {
                renderDayView();
            }
        }

        function renderMonthView() {
            const monthGrid = document.getElementById('monthGrid');
            const calendarTitle = document.getElementById('calendarTitle');
            
            // Set title
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            calendarTitle.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            
            // Clear grid
            monthGrid.innerHTML = '';
            
            // Get first day of month and number of days
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay(); // 0 = Sunday, 1 = Monday, etc.
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'calendar-empty-day';
                monthGrid.appendChild(emptyCell);
            }
            
            // Add cells for each day of the month
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';
                
                // Check if this is today
                if (dayDate.getTime() === today.getTime()) {
                    dayCell.classList.add('today');
                }
                
                // Check if there are trades on this day
                const dayTrades = getTradesForDate(dayDate);
                if (dayTrades.length > 0) {
                    dayCell.classList.add('has-trades');
                    
                    // Check if it's a profit or loss day
                    const dayProfit = dayTrades.reduce((sum, trade) => sum + trade.profit, 0);
                    if (dayProfit > 0) {
                        dayCell.classList.add('profit-day');
                    } else if (dayProfit < 0) {
                        dayCell.classList.add('loss-day');
                    }
                }
                
                // Add day number
                const dayNumber = document.createElement('div');
                dayNumber.className = 'calendar-day-number';
                dayNumber.textContent = day;
                dayCell.appendChild(dayNumber);
                
                // Add trade indicators
                if (dayTrades.length > 0) {
                    const tradeIndicators = document.createElement('div');
                    tradeIndicators.className = 'flex flex-wrap gap-1';
                    
                    dayTrades.forEach(trade => {
                        const indicator = document.createElement('span');
                        indicator.className = 'trade-indicator ' + 
                            (trade.profit > 0 ? 'trade-profit' : 
                             trade.profit < 0 ? 'trade-loss' : 'trade-breakeven');
                        tradeIndicators.appendChild(indicator);
                    });
                    
                    dayCell.appendChild(tradeIndicators);
                    
                    // Add trade count
                    const tradeCount = document.createElement('div');
                    tradeCount.className = 'calendar-day-trades';
                    tradeCount.textContent = `${dayTrades.length} trade${dayTrades.length !== 1 ? 's' : ''}`;
                    dayCell.appendChild(tradeCount);
                    
                    // Add total P&L
                    const dayProfit = dayTrades.reduce((sum, trade) => sum + trade.profit, 0);
                    const profitElement = document.createElement('div');
                    profitElement.className = `calendar-day-pnl ${dayProfit >= 0 ? 'profit' : 'loss'}`;
                    profitElement.textContent = dayProfit >= 0 ? `+${formatCurrency(dayProfit)}` : formatCurrency(dayProfit);
                    dayCell.appendChild(profitElement);
                }
                
                // Add click event to show trades for this day
                dayCell.addEventListener('click', () => showDayTrades(dayDate, dayTrades));
                
                monthGrid.appendChild(dayCell);
            }
        }

        function renderWeekView() {
            const weekGrid = document.getElementById('weekGrid');
            const calendarTitle = document.getElementById('calendarTitle');
            
            // Calculate start of week (Sunday)
            const startOfWeek = new Date(currentDate);
            startOfWeek.setDate(currentDate.getDate() - currentDate.getDay());
            
            // Calculate end of week (Saturday)
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            
            // Set title
            const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            calendarTitle.textContent = 
                `${monthNames[startOfWeek.getMonth()]} ${startOfWeek.getDate()} - 
                 ${monthNames[endOfWeek.getMonth()]} ${endOfWeek.getDate()}, ${endOfWeek.getFullYear()}`;
            
            // Clear grid
            weekGrid.innerHTML = '';
            
            // Add time slots (8 AM to 8 PM)
            for (let hour = 8; hour <= 20; hour++) {
                // Time label
                const timeCell = document.createElement('div');
                timeCell.className = 'week-time-slot text-right pr-2';
                timeCell.textContent = `${hour}:00`;
                weekGrid.appendChild(timeCell);
                
                // Add cells for each day
                for (let i = 0; i < 7; i++) {
                    const dayDate = new Date(startOfWeek);
                    dayDate.setDate(startOfWeek.getDate() + i);
                    
                    const dayCell = document.createElement('div');
                    dayCell.className = 'week-time-slot p-1';
                    
                    // Check for trades in this hour
                    const hourTrades = getTradesForDateAndHour(dayDate, hour);
                    
                    if (hourTrades.length > 0) {
                        hourTrades.forEach(trade => {
                            const tradeElement = document.createElement('div');
                            tradeElement.className = `week-trade-item ${trade.profit >= 0 ? 'week-trade-profit' : 'week-trade-loss'}`;
                            tradeElement.textContent = `${trade.symbol} ${trade.profit >= 0 ? '+' : ''}${formatCurrency(trade.profit)}`;
                            dayCell.appendChild(tradeElement);
                        });
                    }
                    
                    weekGrid.appendChild(dayCell);
                }
            }
        }

        function renderDayView() {
            const dayHeader = document.getElementById('dayHeader');
            const dayTradesContainer = document.getElementById('dayTrades');
            
            // Set header
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            dayHeader.textContent = currentDate.toLocaleDateString('en-US', options);
            
            // Clear trades container
            dayTradesContainer.innerHTML = '';
            
            // Get trades for this day
            const dayTrades = getTradesForDate(currentDate);
            
            if (dayTrades.length === 0) {
                dayTradesContainer.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <div class="text-4xl mb-4">üìä</div>
                        <p class="text-lg">No trades recorded for this day.</p>
                    </div>
                `;
                return;
            }
            
            // Sort trades by time
            dayTrades.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            // Add each trade
            dayTrades.forEach(trade => {
                const tradeElement = document.createElement('div');
                tradeElement.className = 'bg-gray-50 p-4 rounded-lg border-l-4 ' + 
                    (trade.profit >= 0 ? 'border-green-500' : 'border-red-500');
                
                const tradeTime = new Date(trade.timestamp);
                const timeString = tradeTime.toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                tradeElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="font-bold">${trade.symbol} ‚Ä¢ ${trade.type.toUpperCase()}</div>
                            <div class="text-sm text-gray-600">${timeString} ‚Ä¢ ${trade.lotSize} lots</div>
                        </div>
                        <div class="font-bold ${trade.profit >= 0 ? 'text-green-600' : 'text-red-600'}">
                            ${trade.profit >= 0 ? '+' : ''}${formatCurrency(trade.profit)}
                        </div>
                    </div>
                    <div class="mt-2 text-sm">
                        <div>Entry: ${trade.entryPrice} | SL: ${trade.stopLoss} | TP: ${trade.takeProfit || 'N/A'}</div>
                        ${trade.notes ? `<div class="mt-1 text-gray-600">${trade.notes}</div>` : ''}
                    </div>
                `;
                
                dayTradesContainer.appendChild(tradeElement);
            });
        }

        function getTradesForDate(date) {
            // Use your existing allTrades array from the main app
            const trades = window.allTrades || [];
            
            return trades.filter(trade => {
                const tradeDate = new Date(trade.timestamp);
                return tradeDate.getFullYear() === date.getFullYear() &&
                       tradeDate.getMonth() === date.getMonth() &&
                       tradeDate.getDate() === date.getDate();
            });
        }

        function getTradesForDateAndHour(date, hour) {
            const trades = window.allTrades || [];
            
            return trades.filter(trade => {
                const tradeDate = new Date(trade.timestamp);
                return tradeDate.getFullYear() === date.getFullYear() &&
                       tradeDate.getMonth() === date.getMonth() &&
                       tradeDate.getDate() === date.getDate() &&
                       tradeDate.getHours() === hour;
            });
        }

        function showDayTrades(date, trades) {
            const selectedDayTrades = document.getElementById('selectedDayTrades');
            const selectedDayTitle = document.getElementById('selectedDayTitle');
            const selectedDayTradesList = document.getElementById('selectedDayTradesList');
            
            // Set title
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            selectedDayTitle.textContent = `Trades for ${date.toLocaleDateString('en-US', options)}`;
            
            // Clear trades list
            selectedDayTradesList.innerHTML = '';
            
            if (trades.length === 0) {
                selectedDayTradesList.innerHTML = `
                    <div class="text-center text-gray-500 py-4">
                        <p>No trades recorded for this day.</p>
                    </div>
                `;
            } else {
                // Sort trades by time
                trades.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                
                // Calculate day totals
                const totalProfit = trades.reduce((sum, trade) => sum + trade.profit, 0);
                const winningTrades = trades.filter(t => t.profit > 0).length;
                const winRate = (winningTrades / trades.length * 100).toFixed(1);
                
                // Add summary
                const summaryElement = document.createElement('div');
                summaryElement.className = 'bg-blue-50 p-4 rounded-lg mb-4';
                summaryElement.innerHTML = `
                    <div class="flex justify-between">
                        <div>
                            <div class="font-bold">${trades.length} Trade${trades.length !== 1 ? 's' : ''}</div>
                            <div class="text-sm text-gray-600">Win Rate: ${winRate}%</div>
                        </div>
                        <div class="font-bold text-lg ${totalProfit >= 0 ? 'text-green-600' : 'text-red-600'}">
                            ${totalProfit >= 0 ? '+' : ''}${formatCurrency(totalProfit)}
                        </div>
                    </div>
                `;
                selectedDayTradesList.appendChild(summaryElement);
                
                // Add each trade
                trades.forEach(trade => {
                    const tradeElement = document.createElement('div');
                    tradeElement.className = 'trade-item bg-white p-4 rounded-lg border border-gray-200';
                    
                    const tradeTime = new Date(trade.timestamp);
                    const timeString = tradeTime.toLocaleTimeString('en-US', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    const badgeClass = trade.instrumentType === 'forex' ? 'forex-badge' : 'indices-badge';
                    const badgeText = trade.instrumentType === 'forex' ? 'FX' : 'IDX';
                    
                    tradeElement.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div class="flex items-center">
                                <div class="font-bold mr-2">${trade.symbol}</div>
                                <span class="market-type-badge ${badgeClass}">${badgeText}</span>
                            </div>
                            <div class="font-bold ${trade.profit >= 0 ? 'text-green-600' : 'text-red-600'}">
                                ${trade.profit >= 0 ? '+' : ''}${formatCurrency(trade.profit)}
                            </div>
                        </div>
                        <div class="text-sm text-gray-600 mt-1">
                            <div>${timeString} ‚Ä¢ ${trade.type.toUpperCase()} ‚Ä¢ ${trade.lotSize} lots</div>
                            <div>Entry: ${trade.entryPrice} | SL: ${trade.stopLoss} | TP: ${trade.takeProfit || 'N/A'}</div>
                            ${trade.notes ? `<div class="mt-1">${trade.notes}</div>` : ''}
                        </div>
                    `;
                    
                    selectedDayTradesList.appendChild(tradeElement);
                });
            }
            
            // Show the selected day trades section
            selectedDayTrades.classList.remove('hidden');
            
            // Scroll to the section
            selectedDayTrades.scrollIntoView({ behavior: 'smooth' });
        }

        function showDateFilterModal() {
            document.getElementById('dateFilterModal').classList.remove('hidden');
        }

        function closeDateFilterModal() {
            document.getElementById('dateFilterModal').classList.add('hidden');
        }

        function applyDateFilter() {
            const fromDate = document.getElementById('filterFromDate').value;
            const toDate = document.getElementById('filterToDate').value;
            
            if (fromDate && toDate) {
                dateFilter = {
                    from: new Date(fromDate),
                    to: new Date(toDate)
                };
                
                // Apply the filter to trades
                filterTradesByDate(dateFilter.from, dateFilter.to);
                
                closeDateFilterModal();
                renderCalendar();
                
                // Show notification
                showSuccessMessage(`Filter applied: ${fromDate} to ${toDate}`);
            } else {
                alert('Please select both from and to dates.');
            }
        }

        function filterTradesByDate(fromDate, toDate) {
            // This would filter your trades in the actual implementation
            console.log(`Filtering trades from ${fromDate} to ${toDate}`);
            // In a real app, you would update the trades shown based on this filter
        }

        // Use your existing formatCurrency function
        function formatCurrency(amount) {
            // This should use your existing currency formatting
            if (window.formatCurrency) {
                return window.formatCurrency(amount);
            }
            // Fallback
            const currentAccount = window.getCurrentAccount ? window.getCurrentAccount() : { currency: 'USD' };
            const symbol = window.getCurrencySymbol ? window.getCurrencySymbol(currentAccount.currency) : '$';
            return `${symbol}${amount.toFixed(2)}`;
        }

        // Use your existing showSuccessMessage function
        function showSuccessMessage(message) {
            if (window.showSuccessMessage) {
                window.showSuccessMessage(message);
            } else {
                // Fallback
                const successDiv = document.createElement('div');
                successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                successDiv.textContent = message;
                document.body.appendChild(successDiv);
                
                setTimeout(() => {
                    successDiv.remove();
                }, 3000);
            }
        }

        // Add to your existing tab switching function
        function switchToTab(tabName) {
            // Your existing tab switching code...
            
            // Add calendar tab support
            if (tabName === 'calendar') {
                renderCalendar();
            }
        }
    </script>
</body>
</html>